var Modal=ReactBootstrap.Modal,DataImportViewModal=React.createClass({displayName:"DataImportViewModal",componentDidMount:function(){this.initGrid()},initGrid:function(){var e=new Datatable,t=this;e.init({src:$("#data-import-details-datatable"),dataTable:{bState:!0,autoWidth:!1,serverSide:!0,processing:!0,deferRender:!0,ordering:!1,searchDelay:2e3,language:{processing:'<i class="fa fa-spinner fa-pulse fa-fw"></i><span > Loading...</span>.'},lengthMenu:[[10,20,50,100,150],[10,20,50,100,150]],pageLength:10,ajax:{url:Routing.generate("ajax_get_data_import_detail_datatable"),type:"GET",data:function(e){e.hdrId=t.props.hdrId,e.voterName=$('#data-import-details-datatable input[name="import_voter_name"]').val(),e.status=$('#data-import-details-datatable select[name="import_status"]').val()}},columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,n){return n.settings._iDisplayStart+n.row+1}},{data:"voter_name"},{data:"voter_group",width:50,className:"text-center"},{data:"has_id",width:30,className:"text-center",render:function(e){return 1==e?"YES":"NO"}},{data:"cellphone",width:50,className:"text-center"},{data:"updated_at",className:"text-center",width:150,render:function(e){return moment(e).format("MMM DD, YYYY hh:mm A")}},{data:"updated_by",className:"text-center",width:90},{width:30,data:"status",className:"text-center",render:function(e){var t="";switch(e){case"A":t="IMPORTED";break;case"C":t="SKIPPED";break;default:t="UNKNOWN STATUS"}return t}}]}}),t.grid=e},reloadDatatable:function(){this.refs.DetailDatatable.reload()},render:function(){return React.createElement(Modal,{style:{marginTop:"10px"},keyboard:!1,dialogClassName:"modal-full",enforceFocus:!1,backdrop:"static",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{className:"modal-header bg-blue-dark font-white",closeButton:!0},React.createElement(Modal.Title,null,"Data Import Information")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"table-container"},React.createElement("div",{className:"table-actions-wrapper"}),React.createElement("table",{id:"data-import-details-datatable",className:"table table-bordered"},React.createElement("thead",null,React.createElement("tr",{className:"text-center"},React.createElement("td",null,"#"),React.createElement("td",null,"Name"),React.createElement("td",null,"Position"),React.createElement("td",null,"ID"),React.createElement("td",null,"Cellphone"),React.createElement("td",null,"Updated At"),React.createElement("td",null,"Updated By"),React.createElement("td",null,"Status"),React.createElement("td",null)),React.createElement("tr",null,React.createElement("td",null),React.createElement("td",null,React.createElement("input",{type:"text",className:"form-control form-filter input-sm",name:"import_voter_name"})),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null,React.createElement("select",{name:"import_status",className:"input-sm",style:{marginTop:"2px"}},React.createElement("option",{value:""},"All"),React.createElement("option",{value:"A"},"Imported"),React.createElement("option",{value:"C"},"Skipped"))),React.createElement("td",{style:{width:"30px"}},React.createElement("button",{className:"btn btn-xs green btn-outline filter-submit"},React.createElement("i",{className:"fa fa-search"}),"Search")))),React.createElement("tbody",null))))))}});window.DataImportViewModal=DataImportViewModal;var DataImportDatatable=React.createClass({displayName:"DataImportDatatable",getInitialState:function(){return{showViewModal:!1,target:null,typingTimer:null,doneTypingInterval:1500}},componentDidMount:function(){this.initGrid()},initGrid:function(){var e=new Datatable,t=this;e.init({src:$("#data-import-datatable"),dataTable:{ordering:!1,serverSide:!0,processing:!0,searching:!1,deferRender:!0,autoWidth:!0,dom:'<"top"fpli>rt<"bottom"pli><"clear">',searchDelay:2e3,language:{processing:'<i class="fa fa-spinner fa-pulse fa-fw"></i><span > Loading...</span>.'},lengthMenu:[[10,20,50,100,150],[10,20,50,100,150]],pageLength:10,ajax:{url:Routing.generate("ajax_get_data_import_datatable"),type:"GET",data:function(e){e.electId=t.props.electId,e.proId=t.props.proId}},columns:[{data:null,className:"text-center",width:30,render:function(e,t,a,n){return n.settings._iDisplayStart+n.row+1}},{data:"data_source",width:40,className:"text-center"},{data:"total_count",width:50,className:"text-center"},{data:"total_processed",width:50,className:"text-center"},{data:"total_imported",width:50,className:"text-center"},{data:"created_at",className:"text-center",width:80,render:function(e){return moment(e).format("MMM DD, YYYY hh:mm A")}},{data:"created_by",className:"text-center",width:80},{width:40,className:"text-center",render:function(e,t,a){return'<button class="btn btn-xs btn-view btn-primary"> View </button>'}}]}}),$("#data-import-datatable tbody").on("click",".btn-view",function(){var a=e.getDataTable().row($(this).parents("tr")).data();t.openViewModal(a.hdr_id)}),t.grid=e},openViewModal:function(e){console.log("open view modal"),this.setState({showViewModal:!0,target:e})},closeViewModal:function(){this.setState({showViewModal:!1,target:null})},handleFilterChange:function(){var e=this;clearTimeout(this.state.typingTimer),this.state.typingTimer=setTimeout(function(){e.reload()},this.state.doneTypingInterval)},reload:function(){this.grid.getDataTable().ajax.reload()},render:function(){return React.createElement("div",null,this.state.showViewModal&&React.createElement(DataImportViewModal,{show:this.state.showViewModal,onHide:this.closeViewModal,hdrId:this.state.target}),React.createElement("table",{id:"data-import-datatable",className:"table table-bordered"},React.createElement("thead",null,React.createElement("tr",{className:"text-center"},React.createElement("td",null,"#"),React.createElement("td",null,"Data Source"),React.createElement("td",null,"Total Records"),React.createElement("td",null,"Processed"),React.createElement("td",null,"Imported"),React.createElement("td",null,"Date"),React.createElement("td",null,"User"),React.createElement("td",null))),React.createElement("tbody",null)))}});window.DataImportDatatable=DataImportDatatable;var Modal=ReactBootstrap.Modal,FormGroup=ReactBootstrap.FormGroup,HelpBlock=ReactBootstrap.HelpBlock,ControlLabel=ReactBootstrap.ControlLabel,FormControl=ReactBootstrap.FormControl,DataUpdaterModal=React.createClass({displayName:"DataUpdaterModal",getInitialState:function(){return{unselected:[],options:[],form:{data:{projectVoters:[]},errors:[]},isLoading:!1,progressValue:0}},componentDidMount:function(){this.initComponents(),this.loadProjectVoters()},loadProjectVoters:function(){var e=this;e.requestProjectVoters=$.ajax({url:Routing.generate("ajax_get_did_change_voter",{proId:this.props.proId,electId:this.props.electId}),type:"GET"}).done(function(t){e.setState({options:t,unselected:t}),setTimeout(e.refreshSelectBox,2e3)})},componentWillUnmount:function(){this.isEmpty(this.requestProjectVoters)||this.requestProjectVoters.abort()},initComponents:function(){this.initMultiSelect()},initMultiSelect:function(){var e=this,t=this.refs.selectBox;$(t).multiSelect({selectableOptgroup:!0,selectableHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",selectionHeader:"<input placeholder='Enter Name' type='text' class='form-control' autocomplete='off' style='text-transform:uppercase;margin-bottom:5px;'>",afterInit:function(e){var t=this,a=t.$selectableUl.prev(),n=t.$selectionUl.prev(),r="#"+t.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)",l="#"+t.$container.attr("id")+" .ms-elem-selection.ms-selected";t.qs1=a.quicksearch(r).on("keydown",function(e){if(40===e.which)return t.$selectableUl.focus(),!1}),t.qs2=n.quicksearch(l).on("keydown",function(e){if(40==e.which)return t.$selectionUl.focus(),!1})},afterSelect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProjectVoters($(e.refs.selectBox).val())},afterDeselect:function(t){this.qs1.cache(),this.qs2.cache(),e.setProjectVoters($(e.refs.selectBox).val())},cssClass:"fluid-size"})},refreshSelectBox:function(){$(this.refs.selectBox).multiSelect("refresh")},deselectAll:function(){$(this.refs.selectBox).multiSelect("deselect_all")},selectAll:function(){$(this.refs.selectBox).multiSelect("select_all")},setProjectVoters:function(e){var t=this.state.form,a=[];null!=e?(t.data.projectVoters=e,a=this.state.options.filter(function(t){return-1==e.indexOf(t.pro_voter_id)})):(t.data.projectVoters=[],a=this.state.options),this.setState({form:t,unselected:a})},setFormProp:function(e){var t=this.state.form;t.data[e.target.name]=e.target.value,this.setState({form:t})},setErrors:function(e){var t=this.state.form;t.errors=e,this.setState({form:t})},getError:function(e){var t=this.state.form.errors;for(var a in t)if(a==e)return t[e];return null},getValidationState:function(e){return null!=this.getError(e)?"error":null},submit:function(e){e.preventDefault();var t=this,a=t.state.form.data,n=!1;t.requestPostUpdate=$.ajax({url:Routing.generate("ajax_post_updated_records"),type:"POST",data:a,xhrFields:{onprogress:function(e){var a,r=e.currentTarget.response;!1===n?(a=r,n=r.length):(a=r.substring(n),n=r.length),t.setState({progressValue:parseInt(a)})}}}).done(function(){t.props.notify("Data has been imported","ruby"),t.props.onHide(),t.props.onSuccess()}).fail(function(e){t.props.notify("Opps!","ruby"),t.setErrors(e.responseJSON)}).always(function(){t.setState({isLoading:!1,progressValue:0})}),t.setState({isLoading:!0,progressValue:0})},popupCenter:function(e,t,a,n){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,l=void 0!=window.screenTop?window.screenTop:screen.top,o=0,c=0;o=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var s=o/2-a/2+r,i=c/2-n/2+l,d=window.open(e,t,"scrollbars=yes, width="+a+", height="+n+", top="+i+", left="+s);window.focus&&d.focus()},isEmpty:function(e){return null==e||""==e},render:function(){return React.createElement(Modal,{enforceFocus:!1,backdrop:"static",dialogClassName:"modal-custom-85",show:this.props.show,onHide:this.props.onHide},React.createElement(Modal.Header,{closeButton:!0},React.createElement(Modal.Title,null,"Data Updater Modal")),React.createElement(Modal.Body,{bsClass:"modal-body overflow-auto"},React.createElement("form",{onSubmit:this.submit},React.createElement("div",{className:"text-right"},React.createElement("button",{type:"button",onClick:this.deselectAll,className:"btn btn-xs btn-default",style:{marginRight:"5px"}},"Deselect All"),React.createElement("button",{type:"button",onClick:this.selectAll,className:"btn btn-xs btn-success"},"Select All")),React.createElement("div",{className:"clearfix"}),React.createElement("div",{className:"col-md-6 remove-padding"},React.createElement("div",{style:{marginLeft:"-15px"}},React.createElement("strong",null,"Available :")," ",this.state.unselected.length)),React.createElement("div",{className:"col-md-6 "},React.createElement("div",{style:{marginLeft:"30px"}},React.createElement("strong",null,"Selected : ")," ",this.state.form.data.projectVoters.length)),React.createElement(FormGroup,{controlId:"formProjectVoters",validationState:this.getValidationState("projectVoters")},React.createElement("select",{multiple:!0,ref:"selectBox",className:"searchable",id:"voters_multiselect",name:"projectVoters[]"},this.state.options.map(function(e){return React.createElement("option",{key:e.pro_voter_id,value:e.pro_voter_id},e.voter_name," / ",e.barangay_name," (",moment(e.updated_at).format("MMM DD, YYYY hh:mm A"),")")})),React.createElement("div",{className:"text-right"},React.createElement(HelpBlock,null,this.getError("projectVoters")))),React.createElement("div",{className:"clearfix"}),this.state.isLoading&&React.createElement("div",{className:"progress"},React.createElement("div",{className:"progress-bar",role:"progressbar","aria-valuenow":this.state.progressValue,"aria-valuemin":"0","aria-valuemax":"100",style:{width:this.state.progressValue+"%"}},React.createElement("span",null," ",this.state.progressValue," % Complete"))),React.createElement("div",{className:"text-right m-t-md"},React.createElement("button",{type:"button",className:"btn btn-default",style:{marginRight:"10px"},onClick:this.props.onHide},"Cancel"),React.createElement("button",{type:"submit",className:"btn btn-primary"},"Submit")))))}});window.DataUpdaterModal=DataUpdaterModal;var UpdateManager=React.createClass({displayName:"UpdateManager",getInitialState:function(){return{showUpdaterModal:!1,user:null,filters:{proId:null,electId:null,provinceCode:null}}},notify:function(e,t){$.notific8("zindex",11500),$.notific8(e,{heading:"System Message",color:t,life:5e3,verticalEdge:"right",horizontalEdge:"top"})},componentDidMount:function(){this.initSelect2(),this.loadUser(window.userId)},loadUser:function(e){var t=this;t.requestUser=$.ajax({url:Routing.generate("ajax_get_user",{id:e}),type:"GET"}).done(function(e){t.setState({user:e},t.reinitSelect2)})},initSelect2:function(){var e=this;$("#update_manager_component #election_select2").select2({casesentitive:!1,placeholder:"Select Election...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_elections"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.elect_id,text:e.elect_name}})}}}}),$("#update_manager_component #project_select2").select2({casesentitive:!1,placeholder:"Select Project...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_projects"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.pro_id,text:e.pro_name}})}}}}),$("#update_manager_component #province_select2").select2({casesentitive:!1,placeholder:"Enter Province...",allowClear:!0,delay:1500,width:"100%",containerCssClass:":all:",ajax:{url:Routing.generate("ajax_select2_province"),data:function(e){return{searchText:e.term}},processResults:function(e,t){return{results:e.map(function(e){return{id:e.province_code,text:e.name}})}}}}),$("#update_manager_component #election_select2").on("change",function(){var t=e.state.filters;t.electId=$(this).val(),e.setState({filters:t})}),$("#update_manager_component #project_select2").on("change",function(){var t=e.state.filters;t.proId=$(this).val(),e.setState({filters:t})}),$("#voter_table #province_select2").on("change",function(){var t=e.state.filters;t.provinceCode=$(this).val(),e.setState({filters:t})})},reinitSelect2:function(){var e=this;if(!e.isEmpty(e.state.user.project)){var t=e.state.user.project.provinceCode;e.requestProvince=$.ajax({url:Routing.generate("ajax_get_province",{provinceCode:t}),type:"GET"}).done(function(e){$("#update_manager_component #province_select2").empty().append($("<option/>").val(e.province_code).text(e.name)).trigger("change")}),e.requestProject=$.ajax({url:Routing.generate("ajax_get_project",{proId:e.state.user.project.proId}),type:"GET"}).done(function(e){$("#update_manager_component #project_select2").empty().append($("<option/>").val(e.proId).text(e.proName)).trigger("change")})}e.requestActiveElection=$.ajax({url:Routing.generate("ajax_get_active_election"),type:"GET"}).done(function(e){$("#update_manager_component #election_select2").empty().append($("<option/>").val(e.electId).text(e.electName)).trigger("change")}),e.state.user.isAdmin||($("#update_manager_component #election_select2").attr("disabled","disabled"),$("#update_manager_component #province_select2").attr("disabled","disabled"),$("#update_manager_component #project_select2").attr("disabled","disabled"))},openUpdaterModal:function(){console.log("opening updater!"),this.setState({showUpdaterModal:!0})},closeUpdaterModal:function(){this.setState({showUpdaterModal:!1})},isEmpty:function(e){return null==e||""==e||"undefined"==e||e<=0},reloadDatatable:function(){this.refs.importHeaderDatatable.reload()},render:function(){return React.createElement("div",{className:"portlet light portlet-fit bordered",id:"update_manager_component"},React.createElement("div",{className:"portlet-body"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-5"},React.createElement("div",null,React.createElement("h3",null,"Update Manager")),React.createElement("button",{type:"button",onClick:this.openUpdaterModal,className:"btn btn-sm green"},"Download Updates"),this.state.showUpdaterModal&&React.createElement(DataUpdaterModal,{notify:this.notify,show:this.state.showUpdaterModal,onHide:this.closeUpdaterModal,proId:this.state.filters.proId,electId:this.state.filters.electId,provinceCode:this.state.filters.provinceCode,onSuccess:this.reloadDatatable})),React.createElement("div",{className:"col-md-7"},React.createElement("form",{onSubmit:this.onApplyCode},React.createElement("div",{className:"col-md-3 col-md-offset-1"},React.createElement("select",{id:"election_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"province_select2",className:"form-control form-filter input-sm"})),React.createElement("div",{className:"col-md-4"},React.createElement("select",{id:"project_select2",className:"form-control form-filter input-sm"}))))),React.createElement("br",null),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement(DataImportDatatable,{proId:this.state.filters.proId,electId:this.state.filters.electId,ref:"importHeaderDatatable"})))))}});setTimeout(function(){ReactDOM.render(React.createElement(UpdateManager,null),document.getElementById("component-container"))},500);